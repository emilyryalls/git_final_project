{% extends "layout.html" %}

{% block body_content %}
<!-- Hero banner -->
<div class="hero-wrapper" style="position:relative;">
  <div class="hero-banner w-100 text-white d-flex justify-content-center align-items-center flex-wrap text-start"></div>

  <!-- Hero card -->
  <div class="hero-card d-flex">

    <!-- Text side -->
    <div class="text-content flex-grow-1 p-4">
      <h1>YOUR PROFILE</h1>
      <h2>Welcome, {{ user.firstname }}!</h2>
      <p id="hero-description">Here you can find and update all your personal details, stats and goals in one place.</p>
    </div>

    <!-- Image side -->
    <div
      class="hero-img position-relative"
      style="width: 250px; aspect-ratio:1/1; overflow:hidden; border-radius:.5rem;">
      <!-- 1. The photo -->
      <img src="{{ url_for('static', filename=user.profile_pic) if user and user.profile_pic else url_for('static', filename='images/profile_img/default_profile.png') }}" alt="Profile Picture" style="width: 100%; height: 100%; object-fit: contain;">

      <!-- 2. The upload form in the same box -->
      <form action="{{ url_for('upload_profile_pic') }}" method="POST" enctype="multipart/form-data" id="profile-pic-form">
        <label for="profile-pic-input" class="position-absolute bottom-0 end-0 m-2 bg-white border rounded-circle shadow-sm d-flex align-items-center justify-content-center" style="width:36px; height:36px; cursor:pointer;">
          <i class="bi bi-pencil-fill" style="font-size:1rem; color:#333;"></i>
        </label>
        <input type="file" name="profile_pic" id="profile-pic-input" class="d-none" onchange="this.form.submit()">
      </form>
    </div>
  </div>
</div>

<!-- Main content container -->
<div class="main-background-card">
  <div class="row">

    <div class="row g-4">
      <!-- --- Your details --- -->
      <div class="col-md-4">
        <div class="card profile-card p-4 h-100">
          <h3 class="mb-3"><i class="bi bi-person-fill me-2"></i>Your Details</h3>
<!--          <p><strong>Date of Birth:</strong>-->
<!--            {% if user.dob %}-->
<!--              {{ user.dob.strftime('%d %B %Y') }}-->
<!--            {% else %}-->
<!--              <span class="text-muted">Not provided</span>-->
<!--            {% endif %}-->
<!--          </p>-->
          <p><strong>Height:</strong> {{ user.height ~ ' cm' if user.height else 'Not set' }}</p>
          <p><strong>Weight:</strong> {{ user.weight ~ ' kg' if user.weight else 'Not set' }}</p>
          <p><strong>BMI:</strong>
              {% if user.height and user.weight and user.height > 0 %}
                {% set bmi = (user.weight / ((user.height / 100) ** 2)) %}
                {{ bmi | round(1) }}
              {% else %}
                <span>Not available</span>
              {% endif %}
            </p>

            <div class="text-end mt-3">
              <a href="{{ url_for('profile_settings') }}" class="btn btn-join-filled">Edit Details</a>
            </div>
        </div>
      </div>

      <!-- --- Fitness preferences --- -->
      <div class="col-md-4">
        <div class="card profile-card p-4 h-100">
          <h3 class="mb-3"><i class="bi bi-heart-pulse me-2"></i>Fitness Preferences</h3>
          <p><strong>Goal:</strong> {{ user.goal or 'Not set' }}</p>
          <p><strong>Diet:</strong> {{ user.diet or 'Not set' }}</p>
          <p><strong>Experience:</strong> {{ user.experience or 'Not set' }}</p>
          <div class="text-end mt-3">
            <a href="{{ url_for('profile_settings') }}" class="btn btn-join-filled">Set Preferences</a>
          </div>
        </div>
      </div>

      <!-- --- Activity --- -->
      <div class="col-md-4">
        <div class="card profile-card p-4 h-100 text-center">
          <h3 class="mb-3"><i class="bi bi-activity me-2"></i>Your Activity</h3>
          <div class="d-flex gap-4">
            <div class="flex-fill">
              <div class="p-3 h-100 d-flex flex-column justify-content-center">
                <i class="bi bi-calendar-check display-6 text-success"></i>
                {% set streak = user.login_streak or 0 %}
                  <p class="mb-0 mt-2">
                    <strong>{{ streak }}</strong><br>
                    {{ 'day' if streak == 1 else 'days' }}<br>
                    logged
                  </p>
              </div>
            </div>
            <div class="flex-fill">
              <div class="p-3 h-100 d-flex flex-column justify-content-center">
                <i class="bi bi-clock display-6 text-secondary"></i>
                <p class="mb-0 mt-2">
                  <strong>
                    {% if user.last_login %}
                      <span class="d-block">
                        {{ user.last_login.strftime('%d %b %Y') }}
                      </span>
                      <span class="d-block">
                        {{ user.last_login.strftime('%I:%M %p') }}
                      </span>
                    {% else %}
                      <span class="text-muted">â€”</span>
                    {% endif %}
                  </strong>last login
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Milestones -->
    {% set profile_complete = user.dob and user.height and user.weight %}
    <div class="row mt-4 mb-5 align-items-stretch">
      <div class="col-12">
        <div class="card profile-card p-4 h-100" style="min-height: 250px;">
          <h3 class="mb-4"><i class="bi bi-flag-fill me-2"></i>Milestones</h3>
          <div class="d-flex flex-wrap gap-4">
            {% if user.member_since %}
              <span class="badge milestone-badge bg-success">
                Joined: {{ user.member_since.strftime('%b %Y') }}
              </span>
            {% endif %}
            <span class="badge milestone-badge bg-{{ 'success' if profile_complete else 'secondary' }}">
              Profile: {{ 'Complete' if profile_complete else 'Incomplete' }}
            </span>
            <span class="badge goal-badge bg-{{ 'info' if user.goal else 'secondary' }}">
              Goal: {{ user.goal or 'None' }}
            </span>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>


<div class="mb-5"></div>

{% endblock %}