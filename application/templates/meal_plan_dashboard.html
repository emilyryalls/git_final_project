{% extends "layout.html" %}

{% block body_content %}
<!-- Hero banner -->
<div class="hero-wrapper" style="position:relative;">
    <div class="hero-banner w-100 text-white d-flex justify-content-center align-items-center flex-wrap text-start"></div>

    <!-- Hero card -->
    <div class="hero-card">
      <div class="text-content" style="flex: 1; padding: 30px 40px 30px 30px;">
        <h1>Your Meal Plans</h1>
        <h2>Fuel your progress</h2>
        <p id="hero-description">Create and keep track of your nutritious, delicious plans â€” so every bite takes you closer to your best self.</p>
      </div>
      <div class="hero-img">
        <img src="{{ url_for('static', filename='images/banner_img/meal_plans.png') }}" alt="Blog banner image" style="width: 100%; height: 100%; object-fit: contain;">
      </div>
    </div>
</div>

<!-- Main content container -->
<div class="main-background-card py-5">
  <div class="container-fluid">
    <div class="row g-4 align-items-stretch">

      <!-- Left Nav (sticky fullâ€‘height sidebar) -->
      <div class="col-md-3 sidebar d-flex border-0">
        <ul class="nav nav-pills flex-column w-100 border-0" id="mealPlanPills" role="tablist">
          <li class="nav-item" role="presentation">
            <button class="nav-link active" id="pill-current-tab" data-bs-toggle="pill" data-bs-target="#pill-current" type="button" role="tab">
              <i class="bi bi-book me-1"></i> Current Plan
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="pill-editor-tab" data-bs-toggle="pill" data-bs-target="#pill-editor" type="button" role="tab">
              <i class="bi bi-pencil-square me-1"></i> Create/Edit Plan
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="pill-history-tab" data-bs-toggle="pill" data-bs-target="#pill-history" type="button" role="tab">
              <i class="bi bi-clock-history me-1"></i> History
            </button>
          </li>
        </ul>
      </div>

      <!-- Right tabâ€‘content -->
      <div class="col-md-9">
        <div class="tab-content" id="mealPlanPillsContent">

          <!-- Current Plan Pane -->
          <div class="tab-pane fade show active" id="pill-current" role="tabpanel" aria-labelledby="pill-current-tab">
            <div class="card border-0 mb-4">
              <div class="card-body">
                <h4 class="card-title text-center mb-4">Your Current Meal Plan</h4>

                {% if current_meal_plan %}
                  <p class="text-center"><strong>{{ current_meal_plan.name }}</strong></p>
                  <p class="text-muted small mb-0">Created on {{ current_meal_plan.created_at }}</p>
                  <br>
                  <p class="text-center mb-4">{{ current_meal_plan.description }}</p>

                  <div class="table-responsive mb-4">
                    <table class="table align-middle text-center">
                      <thead class="bg-light">
                        <tr>
                          <th></th>
                          {% for day in days %}
                            <th>{{ day }}</th>
                          {% endfor %}
                        </tr>
                      </thead>
                      <tbody>
                        {% for meal in ['Breakfast','Lunch','Dinner','Snacks'] %}
                          <tr>
                            <th class="text-start">{{ meal }}</th>
                            {% for day in days %}
                              <td>
                                {{ current_meal_plan.meals[day][meal.lower()]
                                   if current_meal_plan.meals[day][meal.lower()]
                                   else 'No meal' }}
                              </td>
                            {% endfor %}
                          </tr>
                        {% endfor %}
                      </tbody>
                    </table>
                  </div>

                {% else %}
                  <div class="alert alert-info text-center">
                    No current meal plan.
                    <button class="btn cta-button ms-2" data-bs-toggle="pill" data-bs-target="#pill-editor">
                      Create one now
                    </button>
                  </div>
                {% endif %}
              </div>
            </div>
          </div>

          <!-- Create / Edit Pane -->
          <div class="tab-pane fade" id="pill-editor" role="tabpanel" aria-labelledby="pill-editor-tab">
            <div class="card border-0 mb-4">
              <div class="card-body">
                <h4 class="card-title text-center mb-4">{% if current_meal_plan %}Edit{% else %}Create{% endif %} Meal Plan</h4>
                <form action="{{ url_for('save_meal_plan') }}" method="POST">
                  <input type="hidden" name="plan_name" value="{{ plan_name }}">

                  <div class="mb-4">
                    <label for="meal_plan_description" class="form-label">Plan Description</label>
                    <input type="text" class="form-control custom-dropdown-btn" id="meal_plan_description" name="meal_plan_description" value="{{ current_meal_plan.description if current_meal_plan else '' }}" placeholder="e.g., High-protein, Keto, Budget meals...">
                  </div>

                  <div class="table-responsive mb-4">
                    <table class="table align-middle text-center">
                      <thead class="bg-light">
                        <tr>
                          <th></th>
                          {% for day in days %}
                            <th>{{ day }}</th>
                          {% endfor %}
                        </tr>
                      </thead>
                      <tbody>
                        {% for meal in ['Breakfast','Lunch','Dinner','Snacks'] %}
                          <tr>
                            <th class="text-start">{{ meal }}</th>
                            {% for day in days %}
                              <td>
                                <input
                                  type="text"
                                  name="{{ day }}_{{ meal.lower() }}"
                                  class="form-control form-control-sm custom-dropdown-btn"
                                  placeholder="ðŸ½ï¸ {{ meal }}"
                                  value="{{ current_meal_plan.meals[day][meal.lower()] if current_meal_plan else '' }}"
                                >
                              </td>
                            {% endfor %}
                          </tr>
                        {% endfor %}
                      </tbody>
                    </table>
                  </div>

                  <div class="text-end mt-4">
                    <button type="submit" class="btn cta-button">Save Plan</button>
                  </div>
                </form>
              </div>
            </div>
          </div>

          <!-- History Pane -->
          <div class="tab-pane fade" id="pill-history" role="tabpanel" aria-labelledby="pill-history-tab">
            <div class="card border-0 mb-4">
              <div class="card-body">
                <h4 class="card-title text-center mb-4">Plan History</h4>

                <div class="mb-3">
                  <input type="text" class="form-control" name="search" placeholder="ðŸ” Search by name/date...">
                </div>

                {% if meal_plans %}
                  <table class="table table-hover">
                    <thead>
                      <tr>
                        <th>Name</th>
                        <th>Created</th>
                        <th class="text-end">Actions</th>
                      </tr>
                    </thead>
                    <tbody>
                      {% for plan in meal_plans %}
                        <tr>
                          <td>{{ plan.name }}</td>
                          <td>{{ plan.created_at }}</td>
                          <td class="text-end">
                            <a href="{{ url_for('view_meal_plan', timestamp=plan.created_at) }}" class="btn btn-join-filled">View</a>
                            <a href="{{ url_for('edit_meal_plan', timestamp=plan.created_at) }}" class="btn btn-join-filled">Edit</a>
                            <a href="{{ url_for('clone_meal_plan', timestamp=plan.created_at) }}" class="btn btn-join-filled">Clone</a>
                          </td>
                        </tr>
                      {% endfor %}
                    </tbody>
                  </table>
                {% else %}
                  <div class="alert alert-secondary text-center">No previous meal plans found.</div>
                {% endif %}
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>
  </div>
</div>

<div class="mb-5"></div>

{% endblock %}
